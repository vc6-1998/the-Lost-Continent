// =======================================================================
//                           地图数据定义
// =======================================================================

const wastelandData = {
    name: "仪序域废土",
    img: './assets/img/map/wasteland.png',
    free: [[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]], // 地图网格部分，按要求留空
    enter: { pos: [23, 26] },
    exit: {
        pos: [[47, 25], [47, 26]],
        block: { type: 'dialog',  text: '“礼”的线索似乎还没有找全。' }
    },
    actions: [
        {
            id: 'well_interaction',
            pos: [[28,16]], // 水井坐标
            hint: { text: '一群人围着干涸的水井，气氛很紧张。（按F交涉）' },
            condition: {allFlags:['wasteland_chose_watch']},
            actions: [
                { type: 'cg', url: './assets/img/story/1-3.png' },
                { type: 'dialog', text: '所谓的“水井”不过是一个坍塌了一半的混凝土圈，旁边连着的取水装置早已锈死，只剩一个空荡荡的深坑，底部或许有些浑浊的泥浆。' },
                { type: 'dialog', text: '十几个面黄肌瘦、眼神凶戾的幸存者围成一圈，手里紧握着锈蚀的铁管、磨尖的钢筋，甚至有人手里攥着自制的小刀。他们像一群饿极了的鬣狗，互相警惕，又共同对外。' },
                { type: 'dialog', text: '你的出现让本已紧绷的弦几乎崩断。' },
                { type: 'dialog', text: '一个满脸胡茬、眼角带着狰狞疤痕的男人猛地啐出一口带沙的唾沫。他是这群人里最壮实的，但也瘦得颧骨高耸。' },
                { type: 'dialog', character: './assets/img/character/npc1.png', text: '（他的声音沙哑如砂纸摩擦，充满敌意）哪爬来的？穿得这么干净……是内城那些吸血鬼的走狗，还是来找死的肥羊？' },
                { type: 'dialog', character: './assets/img/character/npc1.png', text: '（他的目光像刀子一样刮过你那相对整洁的衣物和那个空瘪的背包）' },
                { type: 'dialog', text: '人群一阵骚动，所有人眼神中的凶光更盛，下意识地向前逼近了半步，形成一个更具威胁的半圆。有人手指神经质地抽搐，摸向腰间更致命的武器。' },
                { type: 'dialog', character: './assets/img/character/player.png', text: '我不是来找麻烦的。我知道哪里还有干净的水。' },
                { type: 'dialog', text: '这句话像魔法，瞬间让所有动作和咒骂冻结。空气中只剩下粗重的呼吸声。所有目光——怀疑、贪婪、绝望、最后一丝希望——都死死钉在你的身上' },
                { type: 'dialog', character: './assets/img/character/npc2.png', text: '（他死死盯着你的空背包，仿佛想从里面看出水的痕迹。他的喉结剧烈地上下滚动了一下，干裂的嘴唇翕动着，最终挤出几句话）……干净的水？你说真的？' },
                { type: 'dialog', character: './assets/img/character/npc2.png', text: '找到水，（他顿了顿，眼神变得复杂，有渴望，也有更深的警惕）你要什么代价？食物？子弹？还是……别的什么？' },
                
                { type: 'showHint', text: '【即将进入水源探测小游戏】' },
                {
                    type: 'minigame',
                    name: 'water_finder',
                    params: {
                        url: './minigames/water-finder.html', 
                        allowSkip: true
                    },
                    onSuccess: [{
                        type: 'choice',
                        prompt: '如何将水源的消息分享给众人？',
                        options: [
                            {
                                text: '直接分享水源位置',
                                actions: [
                                    { type: 'showHint', text: '【美德共鸣值+10%】'},
                                    { type: 'state_change', virtue: 10 },
                                    { type: 'cg', url: './assets/img/story/1-4.png' },
                                    { type: 'dialog',  text: '一个未被完全污染的旧世界地下水管裂口，当那相对清澈的水流终于代替废水出现时，刚才那脆弱的、由“可能的水”维持的秩序瞬间蒸发。' },
                                    { type: 'dialog',  text: '他们用所能找到的一切容器疯狂装盛，眼睛里只剩下对水的渴望，再无其他。装满的人死死护住容器，头也不回地撒腿就跑，生怕慢一步就会被抢回去。' },
                                    { type: 'dialog',  text: '没有人再看你一眼，更没有人道谢。片刻的“团结”荡然无存，只剩下废土最原始的生存法则。' },
                                    { type: 'dialog',  text: '在一片狼藉中，你弯腰从泥地里捡起一块不知被谁掉落、又被无数双脚踩得稀烂的半块压缩饼干。' },
                                    { type: 'dialog', character: './assets/img/character/player.png', text: '（轻轻捻去饼干上的污渍）……连句客套都省了。也好，直接。【美德＋10%】' },
                                ]
                            },
                            {
                                text: '提议轮流取水',
                                actions: [
                                    { type: 'achievement', id: 1 },
                                    { type: 'showHint', text: '【成就解锁：井边的外交官】'},
                                    { type: 'cg', url: './assets/img/achv/achv1.jpg',text:'成就描述：​​ 并非以力取，而以礼立。你用水源和规则，在这片焦土上播下了第一颗名为“秩序”的种子。' },
                                    { type: 'showHint', text: '【美德共鸣值+15%】'},
                                    { type: 'state_change', virtue: 15 },
                                    { type: 'cg', url: './assets/img/story/1-4.png' },
                                    { type: 'dialog',  text: '一个未被完全污染的旧世界地下水管裂口，当那相对清澈的水流终于代替废水出现。' },
                                    { type: 'dialog',  text: '人们虽然不耐烦，但也还是排队等候，一个瘦小的女孩排在最后，她看起来不像其他人那样着急，甚至开心的冲我笑了笑接完水要离开的时候，赠送饼干。【美德＋15%】' },
                                    { type: 'cg', url: './assets/img/story/1-5.png' },
                                    { type: 'pickup', item: { name: "饼干", description: "小女孩的礼物", image: './assets/img/item/binggan.png' } },
                                ]
                            }
                        ]
                    },
                    ],
                    onFailure: [{ type: 'showHint', text: '【美德共鸣值+5%】'},{ type: 'state_change', virtue: 5 },
                        { type: 'cg', url: './assets/img/story/1-6.png' },
                        { type: 'dialog',  text: '水源流出的依旧是废水，人群骚动，你尴尬表示抱歉和我没有打算抢水，礼数太过周全，他们没说什么，你独自离开了。' },]
                },
                { type: 'completeInteraction' },
            ]
        },
        {
            id: 'well_interaction',
            pos: [[28,16]], // 水井坐标
            hint: { text: '这里应该就是水井了（按F打水）' },
            condition: {allFlags:['wasteland_chose_steal']},
            actions: [
                { type: 'cg', url: './assets/img/story/1-6.png' },
                { type: 'dialog',  text: '水源流出来的是污水，你看了看也没法说什么' },
                { type: 'completeInteraction' },
            ]
        },
        {
            id: 'wall_interaction',
            pos: [[11,23]],
            hint: { text: '这面墙上好像有字。（按F查看）' },
            actions: [
                { type: 'dialog', text: '你走入一片相对安静但更加破败的废墟。这里的幸存者似乎更少，也更沉默，像幽灵一样在阴影里移动。' },
                { type: 'cg', url: './assets/img/story/1-7.png' },
                { type: 'dialog', character: './assets/img/character/player.png', text: '（你环顾四周，目光被一堵相对完整的墙壁吸引）这里人好少。那墙上……好像写了什么？被灰尘和污垢盖满了。' },
                {
                    type: 'branch',
                    condition: { allFlags: ['wasteland_chose_watch'] }, 
                    then: [
                       // { type: 'dialog', character: './assets/img/character/player.png', text: '（辨认着，低声念出）“礼崩乐坏，新贵诞生。姬照居然同意了把礼交易出去，这究竟是大忠还是大奸”后面的字看不清了。' },
                        // { type: 'pickup', item: { name: "墙文拓片", description: "记录着关于“礼”的交易的古老文字。" } },
                        { type: 'cg', url: './assets/img/story/1-8.png' },
                        { type: 'dialog', text: '灰尘被擦去一部分，露出了下面斑驳的油漆字迹。最大的一个字是古老的汉字——【礼】。它的周围还有更多模糊的小字，似乎组成了一句话。' },
                        { type: 'dialog', character: './assets/img/character/player.png', text: '礼崩乐坏，新贵诞生。斯有宰相，以礼乡易...大奸似忠...后面的字看不清了。' },
                        { type: 'state_change', history: 20 },
                        { type: 'dialog',  text: '【历史值+20%】' },
                    ],
                    else: [
                        { type: 'dialog', character: './assets/img/character/player.png', text: '有人追上，来不及细看，赶紧离开' },  
                 ]
                },
                { type: 'completeInteraction' },
            ]
        },
    ]
};

const commandPostData = {
    name: "指挥所内部",
    img: './assets/img/map/command_post.png',
    free : [[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1], [1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1], [1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]],    enter: { pos: [0,17] },
    enter:{ pos:[1,15]},
    exit: { pos: [[0,17],[1,17],[0,16]], 
            block: { type: 'dialog', text: '似乎有东西落下了' }
    }, 
    actions: [
        {
            id: 'document_pickup',
            condition:{ notFlags:['has_pickup_file'] },
            pos: [[3,11]],
            hint: { type: 'dialog', text: '战报桌上好像有东西。(按F查看)' },
            actions: [
                // { type: 'cg', url: './assets/img/story/document.jpg' },
                { type: 'dialog', character: './assets/img/character/player.png', text: '最终指令：以‘义’之名，启动天平计划……代价：熔岩核心失控。' },
                { type: 'pickup', item: {name: "烧焦的文件", description: "上面隐约可见“天平计划”的字样。",image:'./assets/img/item/jimieshan--zhizhang.png'} },
                { type: 'dialog', text: '【历史探索值+5%】' },
                { type: 'state_change', history: 5 },
                { type: 'setFlag',name:'has_pickup_file'}
                // { type: 'effect', name: 'headache' }, // [新功能] 头疼特效
                ,{ type: 'completeInteraction' }
            ]
        },
        {
            id: 'Acquire_token',
            condition:{ notFlags:['has_token'] },
            pos: [[19,5]],
            hint: { type: 'dialog', text: '这里会不会有线索？(按F探查)' },
            actions: [
                { type: 'dialog',text: '义非枷锁，乃心之所向。' },
                //图片还没找好
                { type: 'pickup', item: {name: "半熔的令牌", description: "令牌刻字：“义非枷锁，乃心之所向。”",image:'./assets/img/item/半熔令牌1.png'} },
               // { type: 'dialog', text: '【历史+5%】' },
               // { type: 'state_change', history: 5 },
               { type: 'setFlag',name:'has_token'},
               { type: 'completeInteraction' }
            ]
        },
        {
            id: 'secretenter',
            pos: [[20, 9], [20, 10]],
            condition:
                { allFlags: ['finding_notes'] },
            hint: { type: 'dialog', text: '这个好像需要什么特殊的钥匙' },
            actions:[
                {
                    type: 'branch',
                    condition: { itemsAll: ['半熔的令牌'] }, 
                    // 如果条件为真 (有钥匙)，执行 'then' 里的动作
                    then: [
                        { type: 'dialog', character: './assets/img/character/player.png', text: '门打开了，里面似乎还有一些线索' },
                        { type: 'setTile', col: 20, row: 9,img: './assets/img/map/command_post_door_open_1.png',walkable: true},
                        { type: 'setTile', col: 20, row: 10,img: './assets/img/map/command_post_door_open_2.png',walkable: true},
                        { type: 'completeInteraction' }
                    ],
                    // 如果条件为假 (没钥匙)，执行 'else' 里的动作
                    else: [
                        { type: 'dialog', character: './assets/img/character/player.png', text: '门是锁着的，打不开。' }
                    ]
                }
            ]
        },
        {
            id: 'pick_up_notes',
            pos: [[29,7],[29,8]],
            condition:
            { allFlags:['finding_notes'] },
            hint: { type: 'dialog', text: '这是什么？(按F查看)', },
                actions: [//图片
 
                { type: 'pickup', item: { name: "审判笔记", description: "“大灾变时，我们为自保启动天平计划，但能量失控导致火山喷发……为掩盖过失，高层将‘义’扭曲为绝对服从，任何质疑者皆被审判。真正的‘义’，应是承认错误并修正的勇气。”",image: './assets/img/item/审判笔记.png' } },
                    { type: 'cg', url: './assets/img/story/2-4-1.jpg' },
                    { type: 'cg', url: './assets/img/story/2-4-2.jpg' },
                    { type: 'cg', url: './assets/img/story/2-4-3.jpg' },
                    { type: 'dialog', text: '【历史探索值+10%】' },
                    { type: 'dialog', text: '现在去火山里的地火控制台吧' },
                { type: 'state_change', history: 10 },
                { type:'setFlag',name:'found_notes' },
                { type:'removeFlag',name:'finding_notes' },
                { type: 'completeInteraction' },
            ]
        },
    ]
};
const volcanoData = {
    name: '火山',
    img: './assets/img/map/volcano.png',
    free: [[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]],
    enter:{pos:[10,33]},
    exit:{
        pos:[[59,29],[59,30],[59,31],[59,32],[59,33]],
        block: { type: 'dialog',  text: '这里似乎落下了什么东西' }
    },
    actions:
    [
        {
            id: 'boy',
            pos: [[26,21],[26,22],[26,23],[26,24],[27,21],[27,22],[27,23],[27,24],[28,21],[28,22],[28,23],[28,24],[29,21],[29,22],[29,23],[29,24],[30,21],[30,22],[30,23],[30,24],[31,21],[31,22],[31,23],[31,24]],
            trigger: 'touch',
            condition: { notFlags:['complete_boy'] },
            actions: [//两张审判广场CG图！！
                { type: 'cg', url: './assets/img/story/2-3.png' },
                { type: 'cg', url: './assets/img/story/2-4.png' },
                { type: 'dialog', character: './assets/img/character/审判长1.png', text: '规则即正义。你打翻祭祀用的熔岩晶石，亵渎仪式。现判决：流放至烬坑，直至熔岩洗净罪孽。' },
                { type: 'dialog', character: './assets/img/character/少年里奥11.png', text: '我不是故意的……我只是想救一只被困的熔岩蜥蜴……' },
                { type:'choice',
                    prompt :'你如何面对这场偶然遇到的审判',
                    options:[
                        {
                            text : '直接质疑审判：“规则难道比生命更重要？”',
                            actions: [
                                { type: 'dialog', text: '你与审判长展开了激烈的辩驳' },
                                {
                                    type: 'minigame',
                                    name: 'debate',
                                    params: { url: './minigames/debate.html', allowSkip: true },
                                    onSuccess: [
                                        { type: 'dialog', character: './assets/img/character/审判长2.png', text: '里奥，现判决你无罪。' },
                                        { type: 'dialog', text: '【美德共鸣值+15%】' },
                                        { type: 'state_change', virtue: 15 },
                                        { type: 'dialog', character: './assets/img/character/少年里奥22.png', text: '谢谢你，审判长曾是我父亲……他以前常说‘义是保护弱者的盾’，但现在所有人都只记得规则……，指挥所密室里有他的审判笔记，能不能请你找回它' },
                                        { type: 'setFlag', name: 'success_saved' },
                                        { type: 'setFlag', name: 'finding_notes' },
                                        { type :'dialog', text:'回指挥所内部吧（提示：右下角出口可回指挥室）'},
                                    ],
                                    onFailure: [
                                        { type: 'state_change', virtue: -10 },
                                        { type: 'dialog', text: '你输了，里奥被带走了' },
                                        { type: 'dialog',  text: '【美德共鸣值-10%】' },
                                        { type: 'setFlag', name: 'fail_to_save' },
                                    ]
                                }
                            ]
                        },
                        {
                            text :'提出替代方案：“我愿意代他完成赎罪任务。”',
                            actions :[
                                { type: 'dialog', character: './assets/img/character/审判长1.png', text: '由你替他受刑' },
                                { type: 'dialog', text: '里奥获释' },
                                { type: 'dialog', text: '【美德共鸣值+5%】' },
                                { type: 'state_change', virtue: 5 },
                                { type: 'dialog', character: './assets/img/character/少年里奥22.png', text: '谢谢你，审判长曾是我父亲……他以前常说‘义是保护弱者的盾’，但现在所有人都只记得规则……，指挥所密室里有他的审判笔记，能不能请你找回它' },
                                { type: 'setFlag', name: 'success_saved' },
                                { type: 'setFlag', name: 'finding_notes' },
                                { type :'dialog', text:'回指挥所内部吧（提示：右下角出口可回指挥室）'},
                            ]
                        },
                        {
                            text :'沉默旁观',
                            actions:
                            [
                                { type: 'dialog', text: '里奥被带走了' },
                                { type: 'dialog', text: '【美德共鸣值-5%】' },
                                { type: 'state_change', virtue: -5 },
                                { type: 'setFlag', name: 'fail_to_save' },
                            ]
                        }
                    ]
                },
                { type: 'setFlag', name: 'complete_boy' },
                { type: 'completeInteraction' },
                
            ]
        },
        {
             id :'Restart',
             pos: [[32,17],[33,17],[32,18],[33,18]],
             condition: { allFlags: ['complete_boy'],notFlags:['finding_notes'] },
             hint: {type:'dialog',text:'这里大概就是地表控制台了吧'},
             actions :[//地表控制台的CG！！
                { type: 'cg', url: './assets/img/story/2-5.png' },
                {
                    type:'branch',
                    condition:{allFlags:['success_saved']},  
                    then:[
                        {
                            type:'branch',
                            condition: {itemsAll: ['审判笔记'],},
                            then:[
                                { type :'dialog',text:'你需要通过审判之路——熔岩迷宫'},
                                { type: 'showHint', text: '【即将进入迷宫推箱小游戏】' },
                                {
                                    type: 'minigame',
                                    name: 'push_box',
                                    params: { url: './minigames/push_box.html', allowSkip: true, keepMainBGM: true },
                                    onSuccess: [
                                        { type: 'completeInteraction' },
                                        { type: 'dialog', character: './assets/img/character/审判长1.png', text: '干扰地火运行者，当受极刑！' },
                                        {
                                                    type:'choice',
                                                    prompt: '如何启动地火控制台？',
                                                    options:[
                                                        {
                                                            text: '出示笔记与证据',
                                                            actions:
                                                                [
                                                                    { type: 'dialog', character: './assets/img/character/审判长2.png', text: '(审判长看到笔记后陷入沉默，最终叹息)“我们……确实背叛了‘义’。”' },
                                                                    { type: 'dialog', text: '审判长协助玩家修复控制台，地火平稳，火山威胁解除。' },
                                                                    { type: 'achievement', id: 2 },
                                                                    { type: 'showHint', text: '【成就解锁：枪炮与花】'} ,
                                                                    { type: 'cg', url: './assets/img/achv/achv2.jpg',text:'成就描述：​​你听见了武器的哭诉，而非颂歌。在程序正义的灰烬中，你选择探寻被背叛的“义”。' },

                                                                { type: 'state_change', history: 10 },
                                                                { type: 'state_change', virtue: 10 },
                                                                { type: 'dialog', text: '【历史探索值+10%】【美德共鸣值+10%】' },
                                                            ]                                
                                                        },
                                                        {
                                                            text :'强行启动控制台',
                                                            actions:
                                                            [
                                                                {type :'dialog',text:'地火暂稳,审判长重伤'},
                                                                {type:'dialog',character:'./assets/img/character/审判长1.png',text:'规则崩坏之日，即是毁灭之时……'},
                                                                { type: 'state_change', history: 5 },
                                                                { type: 'state_change', virtue: 10 },
                                                                { type: 'dialog', text: '【历史探索值+5%】【美德共鸣值+10%】' },
                                                            ]
                                                        },
                                                        {
                                                            text:'放弃修复',
                                                            actions:
                                                            [
                                                                {type:'dialog',text:'火山持续喷发，区域永久进入debuff状态'},
                                                            ]
                                                        }
                                                    ]
                                        }
                                        ],
                                    onFailure: [{ type: 'showHint', text: '没关系，再试一次！' }
                                    ]
                                },
                                
                            ],
                            else: [
                                { type :'dialog',text:'先帮里奥找回审判笔记吧'},
                                
                            ]
                        }
                    ],
                    else:[
                        { type :'dialog',text:'你需要通过审判之路——熔岩迷宫'},
                        { type: 'showHint', text: '【即将进入迷宫推箱小游戏】' },
                        {
                            type: 'minigame',
                            name: 'push_box',
                            params: { url: './minigames/push_box.html', allowSkip: true, keepMainBGM: true },
                            onSuccess: [
                                { type: 'dialog', character: './assets/img/character/审判长1.png', text: '干扰地火运行者，当受极刑！' },
                                {
                                    type:'choice',
                                    prompt: '如何启动地火控制台？',
                                    options:[
                                        {
                                            text :'强行启动控制台',
                                            actions:
                                            [
                                                {type :'dialog',text:'地火暂稳,审判长重伤'},
                                                {type:'dialog',character:'./assets/img/character/审判长1.png',text:'规则崩坏之日，即是毁灭之时……'},
                                                { type: 'state_change', history: 5 },
                                                { type: 'state_change', virtue: 10 },
                                                { type: 'dialog', text: '【历史探索值+5%】【美德共鸣值+10%】' },
                                            ]
                                        },
                                        {
                                            text:'放弃修复',
                                            actions:
                                            [
                                                {type:'dialog',text:'火山持续喷发，区域永久进入debuff状态'},
                                            ]
                                        }
                                    ]
                                }
                                ],
                            onFailure: [
                            ]
                        },
                        { type: 'completeInteraction' }
                    ]
                },
            ],        
        },      
    ]
}

// valueChecks: [
//                     { stat: 'virtue', op: '>', value: 5 },
//                     { stat: 'history', op: '>', value: 15 }
//                 ]
const hsData=
{
    name: "衡石域",
    //需要改
    img: './assets/img/map/hengshi.png',
    free : [[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],[0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0], [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0], [0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0],[0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0], [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0]],
    enter: { pos: [3,17] }, 
    exit: { pos:[[31,10],],
        block: { type: 'dialog', text: '再找找其它线索吧' }
    },
    effectZones: [
        {
            effect: 'fadePlayer', 
            area: { 
                from: [19, 11], // 左上角瓦片坐标 [col, row]
                to: [19, 11]    // 右下角瓦片坐标 [col, row]
            },
            // (可选) 定义渐变的目标透明度和速度
            params: {
                targetAlpha: 0.0, // 目标透明度 (0.0 完全透明, 1.0 完全不透明)
                fadeSpeed: 10    // 渐变速度 (每秒改变的透明度量)
            }
        }
    ],
    actions: [
        {
            id: 'command_post_hint',
            condition:{notFlags:['shown_command_post_hint']},
            trigger: 'touch',
            pos: [[5,9]],
            // hint: { type: 'dialog', text: '哎，那是什么？怎么会有屋子？（按F进入）' },
            actions: [
                { type:'setFlag',name:'shown_command_post_hint' },
                { type: 'dialog', text: '哎，这是什么？怎么会有屋子？（按F进入）'},
                { type: 'completeInteraction' }
            ]
        },
        {
            id: 'enter_command_post',
            pos: [[5,8]],
            condition: {allFlags:['shown_command_post_hint'],notFlags:['fail_to_save']},
            actions: [
                { type: 'map', data: new MapData(commandPostData) },
                { type:'setFlag',name:'entered_command_post' },
                {
                    type: 'branch',
                    condition:{ allFlags:['finding_notes'] },
                    then:
                    [{ type: 'completeInteraction' },],
                    else:
                    []
                }
            ]
        },
         {
            id:'enter_volcano',
            pos:[[24,5]],
             condition: {notFlags:['fail_to_save','finding_notes']},
            actions:
            [
                {
                    type:'branch',
                    condition:{allFlags:['entered_command_post']},
                    then:[//需要火山开场CG！！
                        { type: 'cg', url: './assets/img/story/2-2.png' },
                        { type: 'map', data: new MapData(volcanoData) },
                        {
                            type:'branch',
                            condition:{allFlags:['found_notes']},
                            then:[
                                {type: 'completeInteraction' },
                            ],
                            else:[
                            ]
                        } 
                    ],
                    else:[
                        { type: 'dialog', text: '先去指挥室看看吧' },
                    ]
                }
            ]
         },
        
            
   ]
};

const ciguData =
{
    name: ' 慈谷族',
    img: './assets/img/map/ciguyu.png',
    free: [[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0]],
    enter: {pos:[9,17]},
    exit: {
        pos:[[22,16],[22,17]],
        block:{type:'dialog', text: '“仁”的线索似乎还没有找全。'}
    },
    actions:
    [
        {
            id: 'block_by',
            trigger: 'touch',
            pos: [[15,11],[16,11]],
            actions:[
                { type: 'setFlag', name: 'blocked_by_zuren' },
                { type: 'dialog', character: './assets/img/character/player.png', text: '好安静，一个人都没有...' },
                { type: 'dialog', character: './assets/img/character/player.png', text: '（刚要继续往前走，被突然出现的人拦住去路）' },
                { type: 'dialog', character: './assets/img/character/zuren.png', text: '（恶狠狠）你是谁，来这有什么目的？（拿着武器做出打斗准备的动作）' },
                { type: 'dialog', character: './assets/img/character/player.png', text: '（举双手做投降动作）我是个..自由旅行者，来这里想....追寻一下这里的历史，对，感受历史。' },
                { type: 'dialog', character: './assets/img/character/zuren.png', text: '这里没有历史可供外人探寻，我们这里不欢迎你，立刻离开！' },
                { type: 'dialog', character: './assets/img/character/player.png', text: '好吧好吧，我这就走（看来只好换个办法了）' },
                { type: 'completeInteraction' },
            ]
        },
        {
            id: 'girl',
            trigger: 'touch',
            pos: [[18,16],[18,17]],
            condition: { allFlags: ['blocked_by_zuren'] },
            actions:[
                { type: 'cg', url: './assets/img/story/3-2.jpg' },
                { type: 'dialog', text: '你正在准备偷偷进入村庄，突然听到细微的抽泣声。' },
                { type: 'dialog', text: '一个约莫五六岁的小女孩坐在树根上抹眼泪，肚子的咕噜声在寂静中格外清晰。这会不会是什么陷阱？' },
                {
                    type: 'choice',
                    prompt: '远处的骚动，要如何应对？',
                    options: [
                        {
                            text: '上前查看情况，为了确定她安全回家，等到有人来',
                            actions: [
                                { type: 'dialog', character: './assets/img/character/player.png', text: '（犹豫片刻，还是蹲下身轻声问）你怎么一个人在这里？' },
                                { type: 'dialog', character: './assets/img/character/girl.png', text: '呜呜...（哭泣不语）' },
                                { type: 'dialog', text: '你取出随身携带的干粮递过去，小女孩怯生生地接过，小口小口吃了起来。' },
                                { type: 'dialog', text: '突然四周响起急促的脚步声，先前那位青年带着十多个族人围拢过来。' },
                                { type: 'cg', url: './assets/img/story/3-3.jpg' },
                                { type: 'dialog', text: '“放开孩子！”青年怒吼着举起长矛，“你给她吃了什么！”' },
                                { type: 'dialog', text: '正当你要解释时，人群忽然安静下来。' },
                                { type: 'cg', url: './assets/img/story/3-4.png' },
                                { type: 'dialog', text: '一位白发老妪拄着杖走来，小女孩立即扑进她怀里，咿咿呀呀地说着什么。' },
                                { type: 'dialog', text: '老者和周围人的身体渐渐放松，看我的眼神不再充满敌意，片刻后，老人示意青年们放下武器。' },
                                { type: 'dialog', text: '老者看着我，眼神中有一丝不甘却又好像释怀了什么，“我们误会你了，毕竟在我们看来一个外来的人无论如何也不会对我们抱有善意，我替他们向你道歉”' },
                                { type: 'achievement', id: 3 },
                                { type: 'showHint', text: '【成就解锁：谷中回响】' },
                                { type: 'cg', url: './assets/img/achv/achv3.jpg' ,text:'高墙因一块饼干的善意而崩塌。你证明了“仁”能穿透最深的迷雾，连接孤岛。'},
                                { type: 'dialog',  text: '提示：即将进入迷宫小游戏' },
                                {
                                    type: 'minigame',
                                    name: 'maze1',
                                    params: { url: './minigames/maze1.html', allowSkip: true, keepMainBGM: true },
                                    onSuccess: [
                                        { type: 'dialog', text: '族人来送别，给了你一些食物和刻有族徽木板' },
                                    ],
                                    onFailure: [
                                        { type: 'dialog', text: '你被族人带出，他们给了你一些食物和刻有族徽木板，目送他们消失在迷雾中，掌心里不仅捧着礼物，更握着一段刚刚开始融化的历史。' },
                                    ]
                                },
                                { type: 'state_change', virtue: 15 },
                                { type: 'state_change', history: 10 },
                                { type: 'dialog',  text: '【美德共鸣值+15%】【历史恢复进度+10%】' }
                            ]
                        },
                        {
                            text: '上前查看，给她食物后迅速离开，以免被抓到',
                            actions: [
                                { type: 'dialog', character: './assets/img/character/player.png', text: '（犹豫片刻，还是蹲下身轻声问）你怎么一个人在这里？' },
                                { type: 'dialog', character: './assets/img/character/girl.png', text: '呜呜...（哭泣不语）' },
                                { type: 'dialog',  text: '你取出随身携带的干粮递过去，小女孩怯生生地接过，小口小口吃了起来。' },
                                { type: 'dialog', character: './assets/img/character/player.png', text: '她暂时平静下来了，感觉不会出事，后面好像有人来了，得赶紧走' },
                                { type: 'dialog',  text: '提示：即将进入迷宫小游戏' },
                                {
                                    type: 'minigame',
                                    name: 'maze2',
                                    params: { url: './minigames/maze2.html', allowSkip: true, keepMainBGM: true },
                                    onSuccess: [
                                        { type: 'state_change', virtue: 10 },
                                        { type: 'state_change', history: 5 },
                                        { type: 'showHint', text: '【美德共鸣值+10%】【历史探索值+5%】'},
                                    ],
                                    onFailure: [
                                        { type: 'dialog', text: '你被族人发现并赶出了这里，从此这个山谷更加封闭' },
                                        { type: 'state_change', virtue: 5 },
                                        { type: 'state_change', history: 3 },
                                        { type: 'showHint', text: '【美德共鸣值+5%】【历史探索值+3%】'},
                                    ]
                                },
                            ]
                        },
                        {
                            text: '直接离开',
                            actions: [
                                { type: 'dialog', character: './assets/img/character/player.png', text: '(嗯...应该并没有什么危险，抓紧往前走了)' },
                                { type: 'dialog',  text: '提示：即将进入迷宫小游戏' },
                                {
                                    type: 'minigame',
                                    name: 'maze3',
                                    params: { url: './minigames/maze3.html', allowSkip: true, keepMainBGM: true },
                                    onSuccess: [
                                    ],
                                    onFailure: [
                                        { type: 'dialog', text: '你被族人发现并发生打斗，因此被赶出了这里，从此山谷更加封闭' },

                                    ]
                                },
                            ]
                        }
                    ]
                },
                { type: 'completeInteraction' },
            ]
        }
    ]
}
//minigame

const maze = {
    name: "迷宫",
    img: './assets/img/map/maze.png',
    free: [[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0], [0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0], [0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0], [0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0], [0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0], [0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0], [0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0], [0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0], [0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0], [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0], [0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0], [0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1], [0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0], [0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0], [0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0], [0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0], [0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]],
    exit: {
        pos: [[31,12]],
    },
    enter: {pos:[4,17]},
}
const mingjingyu= {
    name: "明镜广场",
    img: './assets/img/map/mingjing.png',
    free : [[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0], [0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0], [0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0], [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1, 0], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0], [1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0], [0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0], [0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]],
    enter: { pos: [16,20] },
    exit: {
        pos: [[23,17],[24,17],[25,17],[23,18],[24,18]],
        block: { type: 'dialog',  text: '“智”的线索似乎还没有找全。' }
    },
    actions: [
        {
            id: 'near eila',
            pos: [[18,9],[19,9],[18,10],[19,10]], //eila坐标
            hint: { text: '一位名叫埃拉的年轻族人正在试图清理巨大石刻星盘上的污垢，但被一名古板的祭司严厉呵斥。（按F交涉）' },
            actions: [
                { type: 'cg', url: './assets/img/story/4-1.jpg' },
                { type: 'dialog', character: './assets/img/character/jisi.jpg', text: '住手！不许触碰圣物！祖先的律法明确规定，任何更改都是亵渎！' },
                { type: 'cg', url: './assets/img/story/4-2.jpg' },
                { type: 'dialog', character: './assets/img/character/player.png', text: '（摸摸下巴）这么宝贝，看来这块星盘就是明镜域的核心所在了。' },
                { type: 'dialog', character: './assets/img/character/player.png', text: '你好啊，你为什么要去擦星盘呢，这好像是上古流传下来的吧' },
                { type: 'dialog', character: './assets/img/character/eila.jpg', text: '（小声对玩家说）可是…我总觉得这上面记载的星辰位置和我们夜空中看到的不一样…' },
                { type: 'dialog', character: './assets/img/character/eila.jpg', text: '你能帮帮我吗，我想向大家证明，这个星盘有误。' },
                {
                    type: 'choice',
                    prompt: '埃拉的求助，应该回应吗',
                    options: [
                        {
                            text: '当然是支持埃拉并质问祭司啦！',
                            actions: [
                                { type: 'showHint', text: '【即将进入记忆配对小游戏】' },
                                {
                                    type: 'minigame',
                                    name: 'memory',
                                    params: { url: './minigames/memory.html', allowSkip: true, keepMainBGM: true },
                                    onSuccess: [
                                        { type: 'state_change', virtue: 15 },
                                        { type: 'dialog',  text: '【美德共鸣值+15%】' }
                                    ],
                                    onFailure: [
                                        { type: 'state_change', virtue: 5 },
                                        { type: 'dialog',  text: '【美德共鸣值+5%】' }
                                    ]
                                }
                            ]
                        },
                        {
                            text: '敌多我寡，见机行事，悄悄帮助埃拉。',
                            actions: [
                                { type: 'showHint', text: '【即将进入记忆配对小游戏】' },
                                {   type: 'minigame', 
                                    name: 'memory',
                                    params: { url: './minigames/memory.html', allowSkip: true, keepMainBGM: true },
                                    onSuccess: [
                                        { type: 'achievement', id: 4},
                                        { type: 'showHint', text: '【成就解锁：擦星人】' },
                                        { type: 'cg', url: './assets/img/achv/achv4.jpg' ,text:'你擦去的不是污垢，是蒙蔽真理的尘埃。愿文明永远保持抬头仰望、质疑权威的勇气。'},
                                        { type: 'state_change', virtue: 10 },
                                        { type: 'dialog',  text: '【美德共鸣值+10%】' }
                                    ],
                                    onFailure: [
                                        { type: 'state_change', virtue: 5 },
                                        { type: 'dialog',  text: '【美德共鸣值+5%】' }
                                    ]
                                }
                            ]
                        },
                        {
                            text:'祭祀看上去使个会给好处的人，嗯，附和一下。',
                            actions:[
                                { type:'dialog',text:'埃拉失望而去，你沉默了一下，心情有点低落。然后...又好了。'},
                                { type: 'pickup', item: { name: "金币", description: "祭司给的谢礼", image:'./assets/img/item/coin.png' } },
                                { type: 'state_change', virtue: -10},
                                { type: 'dialog',  text: '【美德共鸣值-10%】' },
                            ]
                        }
                    ]
                },
                { type: 'completeInteraction' },
            ]
        },
        {
            id: 'put_into',
            pos: [[12,3],[12,4]],
            hint: { text: '这里好像是祭坛的基座（按F交互）' },
            // condition: {
            //     itemsAll: ['碎片'],
            //     itemQuantities: [
            //         { name: "碎片", op: ">=", count: 3 }
            //     ]
            // },
            actions: [
                { type: 'dialog', character: './assets/img/character/eila.jpg', text: '快！把这些碎片放到基座对应的凹槽里试试！' },
                
                    //检查背包里有三个碎片，不会写
                { type: 'cg', url: './assets/img/story/4-3.jpg',text:'星盘发出了耀眼的光，围观的人发出了惊叹。' },
                { type: 'bgm', name: 'note', fade: 800, loop: true, volume: 0.8 },
                //此处应当配有激昂音乐
                { type: 'state_change', history:5},
                { type: 'dialog',  text: '【历史探索值+5%】'},
                { type: 'dialog', character: './assets/img/character/jisi.jpg', text: '妖言惑众！你这是扭曲圣物！'},
                { type: 'choice',
                    prompt: '如何质问祭司？',
                    options: [
                        {
                            text:'是你害怕真相！',
                            actions:[
                                { type: 'state_change', virtue: 5 },
                                { type: 'dialog',  text: '【美德共鸣值+5%】' },
                                { type: 'dialog', character: './assets/img/character/player.png', text: '（直视祭司）是你害怕真相！' },
                                { type: 'dialog', character: './assets/img/character/jisi.jpg', text: '（脸色骤变）放肆！你一个外人竟敢质疑明镜族的传统！' },
                                { type: 'dialog',  text: '你与祭司激烈争吵起来，场面一度十分紧张。周围的族人面面相觑，不知所措。你愤怒地离开了这里。' }
                            ]
                        },
                        {
                            text:'我们该相信眼睛看到的，还是纸上写的？',
                            actions:[
                                { type: 'state_change', virtue: 20 },
                                { type: 'dialog',  text: '【美德共鸣值+20%】' },
                                { type: 'dialog', character: './assets/img/character/player.png', text: '（转向聚集的族人，声音洪亮）我们该相信眼睛看到的，还是纸上写的？' },
                    
                                { type: 'dialog',character: './assets/img/character/eila.jpg', text: '（立即站出来）他说得对！智慧的第一步是看清眼前的事实，而不是盲目服从！我们明镜族不该是这样！' },
                                { type: 'dialog', character: './assets/img/character/jisi.jpg',  text: '（震惊地后退一步）埃拉！你竟敢...' },
                                { type: 'dialog',  text: '人群中开始窃窃私语，一些年轻的族人点头表示赞同，古老的传统第一次受到了公开质疑。' }
                            ]


                        }
                    ]
                },
                { type: 'setFlag', name: 'has_putted_into'},
                { type: 'completeInteraction' },
            ]
        },
        {
            id:'ans',
            pos:[[11,3],[11,4],[13,3],[13,4],[12,2],[12,5]],
            trigger: 'touch',
            condition: { allFlags: ['has_putted_into'] },
            actions:
            [
                { type: 'state_change', history: 20 },
                { type: 'dialog',  text: '【历史探索值+20%】' },
                { type:'dialog',text:'你收获了一本祭司的残缺的星图日记'},
          
                { type: 'cg', url: './assets/img/story/4-4-1.jpg'},
                { type: 'cg', url: './assets/img/story/4-4-2.jpg'},
                { type: 'cg', url: './assets/img/story/4-4-3.jpg'},
                { type: 'cg', url: './assets/img/story/4-4-4.jpg'},
                { type: 'completeInteraction' },
            ]
        }           
    ]
}
                
const jizhan = {
    name: "基站",
    img: './assets/img/map/jizhan.png',
    free : [[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]],
    enter: { pos: [2,9]},
    exit: {
        pos: [[12,9],[13,9],[14,9]],
        block: { type: 'dialog',  text: '好像还有线索没看完，再看看吧' }
    },
    actions: [
        {
            id: 'feiqiguangbotai',
            pos: [[3,5],[4,5],[5,5]],
            condition: {notFlags: ['has_guangbo']},
            hint: { text: '你在断壁残垣中穿梭，终于在一片爬满藤蔓的建筑里找到目标——这是一个早已废弃的广播站，在岁月里长久地沉默，也许它也在等待有缘人。（按F尝试回应）' },
            actions: [
                { type: 'dialog', text: '你按下调音台上唯一没损坏的电源键，电流滋滋作响后，老旧的扬声器突然传出沙哑却清晰的广播声：' },
                { type: 'state_change', history: +15, },//增加标签
                { type: 'setFlag', name: 'radio_activated'},
                { type: 'dialog', text: '【历史探索值+15%】' },
               // { type: 'audio', url: './assets/audio/story/old_radio_voice.mp3' }, // 广播声音频：……他们以为‘信’是无用的累赘？可笑。既然选择背叛信仰，就以背叛之名……彻底清洗！所有基站听令：即刻起，向其余四族——宣战！
                { type: 'se', name: '2'},
                { type: 'dialog',  text: '“这段录音似乎记录了当年誓约族高层下达突袭命令的瞬间。‘清洗’……原来那场劫难并非天灾，而是人祸。”' },
                { type: 'setFlag', name: 'has_guangbo'},
                { type: 'completeInteraction' },
            ]
        },
        {
            id:'jimixiang',
            pos:[[9,6],[10,6]],
            trigger: 'touch',
            actions:[
                { type: 'dialog',  text: '你在广播台角落的铁柜后，发现了一个挂着铜锁的金属机密箱，箱体印着模糊的“誓约族绝密”字样，锁孔处嵌着密码转盘——显然需要破解才能打开。' },
                { type: 'dialog',  text: '你想要解开机密箱，却没想到触动了防御机关，突然被传送到了一间密室里。好吧，现在你的任务变成了从密室中逃出来，而且...似乎机密箱的密码就藏在密室的出口。' },
                
                {
                    type: 'minigame',
                    name: 'jimixiang',
                    params: { url: './minigames/jiemi1.html', allowSkip: true },
                   
                    
                    onSuccess: [
                        {type:'cg',url: './assets/img/story/5-5.jpg'},
                        { type: 'dialog',  text: '你成功了，不仅逃出生天，还拿到了密码。' },
                        { type: 'dialog',  text: '密码转盘 “咔嗒” 一声弹开，机密箱的盖子缓缓打开。' },
                        //{ type: 'pickup', item: { name: "绝密文件", description: "记录誓约族当年战争真相的核心文件，纸张泛黄却字迹清晰" },image:'' },
                        { type:'cg',url:'./assets/img/story/5-6.jpg'},
                        { type: 'state_change', history: +15},//加标签
                        { type: 'setFlag', name: 'jimixiang_unlocked_success'},
                        { type: 'dialog',  text: '【历史探索值+15%】' },
                    ],
                    onFailure: [
                        //{ type: 'audio', url: './assets/audio/story/taunt_voice.mp3' }, // 录音内容
                        { type: 'dialog',  text: '密室发出刺耳的警报声，扬声器里突然传出冰冷的嘲讽：' },
                        { type: 'dialog',  text: '“菜就多练。”' },
                        { type: 'dialog',  text: '你被扔出了这个小楼，这合理吗？这个基站简直成精了。' },
                        // { type: 'map', data: new MapData(shiyueyu) }//回到誓约域地图，但我不知道这么写会不会对读档产生影响
                    ]
                },
                { type: 'completeInteraction' },
            ]
        }
    ]
};

// 誓约域地图数据（修复后）
const shiyueyu = {
    name: "誓约域",
    img: './assets/img/map/shiyueyu.png',
    free: [
        [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1],
        [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1],
        [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1],
        [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1],
        [1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1],
        [1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0],
        [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0],
        [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
    ],
    enter: { 
        pos: [1,17]
    },
    exit: {
        pos: [[7,17], [8,17], [9,17]],
        block: { type: 'dialog',  text: '好像还有线索没看完，再看看吧' }
    },
    actions: [
        // —— ① 自动提示：仅提示一次，不进入地图 ——
        // 踩上去自动提示“这里似乎是？废弃基站！”，并打个标记，避免每次路过都弹
        {
            id: 'jizhan_hint',
            trigger: 'touch',
            condition: { notFlags: ['jizhan_hint_seen'] }, // 第一次才提示
            pos: [[3, 7], [4, 7], [5, 7]], // ← 用你原来的坐标
            actions: [
                { type: 'dialog', text: '这里似乎是？废弃基站！' },
                { type: 'setFlag', name: 'jizhan_hint_seen' },
                { type: 'completeInteraction' },
            ]
        },

        // —— ② 有“广播台”未完成时，按F进入 ——
        // 只要广播台还没完成，就允许进入基站
        {
            id: 'jizhan_enter_if_broadcast_not_done',
            trigger: 'touch',
            condition: { notFlags: ['has_guangbo'] }, // 只要没获得 has_guangbo，就允许进入
            pos: [[3, 7], [4, 7], [5, 7]], // ← 用你原来的坐标
            actions: [
                { type: 'map', data: new MapData(jizhan) },
                { type: 'completeInteraction' },
            ]
        },

        // —— ③ 有“机密箱”未完成时，按F进入 ——
        // 只要机密箱没通关（没拿到绝密文件），也允许进入
        {
            id: 'jizhan_enter_if_secret_not_done',
            trigger: 'touch',
            condition: { notFlags: ['jimixiang_unlocked_success'] }, // 只要没成功解密，就允许进入
            pos: [[3, 7], [4, 7], [5, 7]], // ← 用你原来的坐标
            actions: [
                { type: 'map', data: new MapData(jizhan) },
                { type: 'completeInteraction' },
            ]
        },


        {
            id: 'shiyueguangchang',
            trigger: 'touch',
            pos: [[22,12], [22,13], [22,14], [22,15], [22,16], [22,17], [22,13]], 
            actions: [
                { type: 'removeFlag', name: 'marco_helped' },

                { type: 'cg', url: './assets/img/story/5-1.jpg' },
                { type: 'dialog',  text: '广场上人来人往，但气氛诡异。商贩们的笑容过于热络，眼神却游移不定；顾客们紧紧捂着钱包，对每一个靠近的人都报以怀疑的目光。' },
                { type: 'dialog',  text: '【这片土地似乎不太诚信】' },

                { type: 'cg', url: './assets/img/story/5-2.jpg' },
                { type: 'dialog', character: './assets/img/character/maerke.jpg', text: '哎呀，这位看起来就很可靠的朋友！拜托了，请你一定要帮帮我！我的传家宝——一枚古老的‘誓约银币’，刚才不小心掉进广场那边那个废弃的排水沟里了！那下面又黑又深，我这把老骨头实在爬不进去……' },
                { type: 'dialog', character: './assets/img/character/maerke.jpg', text: '(他指向广场角落一个锈迹斑斑的铁栅栏，栅栏的缝隙确实很窄。)' },
                { type: 'dialog', character: './assets/img/character/maerke.jpg', text: '只要你帮我捞上来，我愿意付你100信用点（当地货币）作为酬劳！我马尔科以……呃，以我的名誉担保！我就在这等着，绝不走开' },

                {
                    type: 'choice',
                    prompt: '帮不帮马尔科？',
                    options: [
                        {
                            text: '挺身而出',
                            actions: [
                                { type: 'showHint', text: '【即将进入捡金币小游戏】' },


                                {
                                    type: 'minigame',//捡银币游戏插入
                                    name: 'jianyingbi',
                                    params: { url: './minigames/coin.html', allowSkip: true, keepMainBGM: true },
                                    onSuccess: [ 
                                        { type: 'state_change', virtue: +10},
                                        { type: 'dialog', text: '【美德+10%】你英勇地挺身而出，摸到了银币，代价是一手泥。' },
                                        { type: 'setFlag', name: 'marco_helped' },  // ← 删掉这行（你现在放在开头）

                                    ],
                                    onFailure: [ 
                                        { type: 'state_change', virtue: +5},
                                        { type: 'dialog', text: '【美德+5%】你英勇地挺身而出，却没想摸不到银币，尴尬地挠挠头。' },
                                        { type: 'setFlag', name: 'marco_helped' },  // ← 删掉这行（你现在放在开头）

                                    ]
                                }
                            ]
                        },
                        {
                            text: '无能为力',
                            actions: [
                                { type: 'state_change', virtue: +0},
                                { type: 'dialog', text: '【美德+0】你试着探了探银币，并不想牺牲自己的衣服，遂罢。' },
                                { type: 'completeInteraction' }   
                            ]
                        }
                    ]
                },
                {
                    type: 'branch',
                    condition: { allFlags: ['marco_helped'] },
                    then: [
                        // 这里放原来“？马尔科怎么不见了 → CG → 老太婆对白 …”整段

                        { type: 'cg', url: './assets/img/story/5-2-2.jpg' },
                        { type: 'dialog', text: '？马尔科怎么不见了' },
                        
                        { type: 'dialog', text: '四下张望，看到马尔科正站在广场的另一头，和另一个玩家模样的路人重复着完全相同的说辞，表情依然是那么“真诚”和“焦急”。' },
                        { type: 'dialog', text: '（你似乎听到一声嗤笑）' },
                        { type: 'cg', url: './assets/img/story/5-3.jpg' },
                        { type: 'dialog', character: './assets/img/character/laotaipo.jpg', text: '哼，又一个上当的。那栅栏下面什么都没有，他每天都要在那演上十几遍。那枚‘银币’永远都掉在下面，也永远没人能‘找回来’。' },
                        { type: 'dialog', character: './assets/img/character/player.png', text: '他为什么要这么做？' },
                        { type: 'dialog', character: './assets/img/character/laotaipo.jpg', text: '(咧嘴一笑，露出稀疏的牙齿)为什么？如果你真帮他“找到”了，他就会说那根本不是他的银币，反咬你一口，说你偷换了他的真宝贝，然后勒索你一笔更大的“封口费”。如果没找到，就像现在，他直接溜走，省下了承诺的100信用点。怎么样，稳赚不赔的买卖，不是吗？' },
                        { type: 'dialog', character: './assets/img/character/laotaipo.jpg', text: '这就是我们誓约域的‘诚信’之道。孩子，‘信’若成了算计的筹码，它便连废铁都不如——至少废铁还能砸人' },
                        { type: 'dialog', character: './assets/img/character/laotaipo.jpg', text: '老太婆不再理会你，转而用同样热络的笑容招呼其他潜在顾客：“来看看吧，绝对真货！假一赔十！”' },
                        { type: 'dialog', text: '——尽管她卖的东西，明显都是些粗制滥造的仿制品......' },
                        {
                            type: 'choice',
                            prompt: '马尔科还在行骗，你该怎么做？',
                            options: [
                                {
                                    text: '揭露骗局',
                                    actions: [
                                        { type: 'state_change', virtue: +10 },
                                        { type: 'dialog', text: '碰到我算你踢到铁板了！马尔科，你的骗局完了。' }
                                    ]
                                },
                                {
                                    text: '袖手旁观',
                                    actions: [
                                        { type: 'state_change', virtue: +3 },
                                        { type: 'dialog', text: '【美德+3%】这里每天都会发生这种事情，我管不过来。' }
                                    ]
                                },
                                {
                                    text: '加入骗局！',
                                    actions: [
                                        { type: 'state_change', virtue: -10 },
                                        { type: 'pickup', item: { name: "金钱", description: "亮闪闪的信用点谁不爱呢", image: './assets/img/item/coin.png' } },
                                        { type: 'dialog', text: '【美德-10%】有钱不赚王八蛋，且看我加入马尔科，赚点盘缠。' }
                                    ]
                                }
                            ]
                        },],
                    else: []
                },
                { type: 'completeInteraction' },
            ]
        },
        {
            id: 'stone',
            trigger: 'interact',
            pos: [[24,4], [24,5], [24,6], [24,7], [24,8], [25,7], [26,7], [27,7], [28,7], [28,4], [28,5], [28,6], [28,7], [27,4], [26,4], [25,4],[25,6],[25,5]], 
            hint: { type: 'showHint', text: ' 这里就是誓言石阵（按F交互）' },
            actions: [
                { type: 'dialog',  text: ' 你终于抵达誓言石阵。古老的青灰色石块按星轨排列，中心阵眼处嵌着一个不规则凹槽，表面还残留着淡淡的能量纹路，仿佛在无声等待某种物品的契合。' },
                { type: 'dialog',  text: '【似乎需要往上放置一本书】' },
                {
                    type: 'branch',
                    condition:
                        { allFlags: ['jimixiang_unlocked_success']},
                    then:
                    [
                        { type:'dialog',text:'你思索片刻，放入了刚刚在基站找到的【绝密文件】'},
                        { type: 'cg', url: './assets/img/story/5-4.png' },
                        { type: 'state_change', virtue: +5},
                        { type: 'setFlag', name: 'shizhen_activated_jumiewenjian'},
                            { type: 'dialog', text: '【美德共鸣值 + 5%】' },
                            { type: 'achievement', id: 5 },
                            { type: 'showHint', text: '【成就解锁：铁板与骗局】' },
                           { type: 'cg', url: './assets/img/achv/achv5.jpg',text:'你让真相在石阵上重生。信”不是交易的筹码，而是文明的基石。' },
                        { type: 'dialog',  text: ' 当【绝密文件】放入凹槽的瞬间，石阵突然迸发金色光芒，纹路如活物般流转，将整个阵体包裹其中。' },
                        { type: 'dialog',  text: '誓约族尘封的旧事，正随着鎏金般的光芒在天幕之上缓缓铺展 —— 那些被岁月掩埋的过往，此刻如活过来的画卷般清晰流转。'},
                        { type: 'dialog',  text: '漫过石阵每一道古老纹路的光芒里，誓约族人纷纷垂首，沉默地凝视着那座重归完整的石阵。没有人说话，却能看见他们眼底的颤动。'}, 
                        { type: 'dialog',  text:'显然没有人生来狡猾不守信，也许转机就在一个触动里。尽管前路漫长，但属于誓约族人的救赎已然启程。'   },
                        { type: 'completeInteraction' },
                    ],
                    else: [ 
                        { type:'dialog',text:'你随便放入了一个东西试探了一下'},              
                        { type:'dialog',text:'石阵吐出了你的东西并表达了祂的不屑'},
                    ]
                }
            ]
        }
    ]
};



// =======================================================================
//                           主线剧情流程
// =======================================================================
window.storyData = [
    // ==========================================================
    //                           序幕
    // ==========================================================
    { type: 'cg', url: './assets/img/story/0-1.jpg', text: '序幕' },
    { type: 'bgm', name: 'prologue_theme', fade: 800, loop: true, volume: 0.65 }, 
    { type: 'se', name: '1'}, 
    { type: 'dialog', text: '（古老声音）天地初开便有衡器，称得出善恶重，量得了生死盈亏。' },
    { type: 'cg', url: './assets/img/story/0-2.jpg' },
    { type: 'cg', url: './assets/img/story/0-3.jpg' },
    { type: 'dialog',  text: '传说中有这样一片乐土，诸族循守古律，“仁、义、礼、智、信”，众生和睦，万象井然。' },
    { type: 'cg', url: './assets/img/story/0-4.jpg' },
    { type: 'dialog',  text: '然而，灾厄突然降临。无人知晓发生了什么。' },
    { type: 'cg', url: './assets/img/story/0-5.jpg' },
    { type: 'dialog',  text: '历史就此断档，只留下了半截断代石碑，与已成一片废墟的大陆。' },
    { type: 'dialog',  text: '现在，遗失之大陆虽自废墟中重生……但那深埋的阴影，却始终未曾消散。' },

    // ==========================================================
    //                           政府
    // ==========================================================
    { type: 'cg', url: './assets/img/story/0-6.jpg', text: '政府办公室' },
    { type: 'dialog', character: './assets/img/character/B.png', text: '（神色凝重）你也看到了，照现在的趋势，五域——我们赖以生存的环境，撑不了多久了。' },
    { type: 'dialog', character: './assets/img/character/player.png', text: '（眉头紧锁，手指无意识地敲击桌面）比上次报告的数据又恶化了15%……能源枯竭的速度超出预期。' },
    { type: 'dialog', character: './assets/img/character/B.png', text: '现在上级把全部希望都寄托在了那个古老的传说上——那时有与现在截然不同的生活。' },
    { type: 'effect', name: 'headache' }, // 头疼特效
    { type: 'dialog', character: './assets/img/character/player.png', text: '（突然扶住额头，脸色发白）呃……' },
    { type: 'dialog', character: './assets/img/character/B.png', text: '（关切地扶住）怎么了？又头疼了？' },
    { type: 'dialog', character: './assets/img/character/player.png', text: '（摆摆手，勉强站稳）……每次听到这个传说就会这样。我没事，继续说。' },
    { type: 'dialog', character: './assets/img/character/B.png', text: '（仔细观察A的状态后继续）但是文明断档导致我们无法知晓当时的情况，也没有具体的行动方向，只好派出调查员去各个域进行秘密调查，以求获得一些蛛丝马迹，我能信任的只有你了。（郑重地拍拍A的肩膀）' },
    { type: 'dialog', character: './assets/img/character/player.png', text: '（揉着太阳穴，眼神逐渐坚定）正好我也想知道，那传说中的世界到底是什么样子。（握紧调查装置）放心交给我。' },
    { type: 'dialog', character: './assets/img/character/B.png', text: '（交给A一个道具）一切小心。' },
    { type: 'pickup', item: { name: "历史记录装置", description: "可以记录发现，补充消失的历史。", image:'./assets/img/item/记录.png' } },
    // ==========================================================
    //                     第一幕 仪序域 (礼) - 废土 开场
    // ==========================================================
    { type: 'cg', url: './assets/img/story/1-1.png', text: '第一幕 仪序域' },
    { type: 'bgm', name: 'wasteland_day', fade: 800, loop: true, volume: 1 },
    { type: 'dialog', text: '你第一站来到了仪序域，这里原是礼的发源地，只是现在已经沦为一片废土。' },
    { type: 'dialog', text: '脚下是塑料瓶和碎玻璃被踩瘪压碎的嘎吱声、黏腻的拉扯声，远处风声呜咽，带着金属锈蚀的刺鼻味和有机物腐败的酸臭味。' },
    { type: 'dialog', character: './assets/img/character/player.png', text: '（深一脚浅一脚地踩在连绵起伏的垃圾山上）' },
    { type: 'dialog', text: '突然，远处传来一声陶罐被狠狠摔碎的刺耳脆响，紧接着是几个人声嘶力竭的咆哮和谩骂，打破了黄昏虚假的宁静。' },
    { type: 'dialog', character: './assets/img/character/player.png', text: '（停住脚步，抬头望向声音来源）' },
    { type: 'cg', url: './assets/img/story/1-2.png' },
    { type: 'dialog', character: './assets/img/character/player.png', text: '（眉头微蹙，低声自语）帐篷那边……不是吵架，是快要见血了。' },
    {
        type: 'choice',
        prompt: '远处的骚动，要如何应对？',
        options: [
            {
                text: '直接偷偷取水',
                actions: [
                    { type: 'state_change', virtue: -5},
                    { type: 'setFlag', name: 'wasteland_chose_steal' },
                    { type: 'dialog', text: '【美德-5%】你决定避开人群，直接去水源处。' },
                    { type: 'dialog', text: '然而，你的行踪很快就被发现了，你遭到了攻击，拼尽全力也无法战胜，只好趁机逃跑。' },
                   
                ]
            },
            {
                text: '看热闹是人的天性，走你！',
                actions: [
                    { type: 'state_change', virtue: 5},
                    { type: 'setFlag', name: 'wasteland_chose_watch' },
                    { type: 'dialog', text: '【美德+5%】你决定靠近一些，看看究竟发生了什么。' },
                ]
            }
        ]
    },
    { type: 'map', data: new MapData(wastelandData) },


    // ==========================================================
    //                     第二幕 衡石域（义）-火山
    // ==========================================================
    { type: 'bgm', name: 'quanyou', fade: 800, loop: true, volume: 0.5 },
    { type: 'cg', url: './assets/img/story/2-1.png', text: '第二幕 衡石域' },
    { type: 'dialog', text: '衡石，意为用于衡量轻重的天平和砝码，引申意为“义”：公平、公正、不偏不倚​。​' },
    { type: 'dialog', text: '相传居住在此的衡石族拥有“义”之心。​' },
    { type: 'map', data: new MapData(hsData) },
    // ==========================================================
    //                     第三幕 慈谷族 （仁） - 山谷 
    // ==========================================================
    { type: 'bgm', name: 'valley_day', fade: 800, loop: true, volume: 0.3 },
    { type: 'cg', url: './assets/img/story/3-1.jpg', text: '第三幕 慈谷族' },
    { type: 'dialog', text: '听说这个族一直不与外族人来往，山谷是天然屏障，关于他们的信息很少' },
    { type: 'dialog', text: '慈谷族的山谷静悄悄的，雾气缠绕着远处的木屋，仿佛一片被时间遗忘的秘境。' },
    { type: 'map', data: new MapData(ciguData)},
    // ==========================================================
    //                     第四 明镜(智)
    // ==========================================================
    { type: 'bgm', name: 'mingjing', fade: 800, loop: true, volume: 0.8 },
    { type: 'cg', url: './assets/img/story/4-0.jpg', text: '第四幕 明镜族' },
    { type: 'dialog', text: '心如明镜，智者无疆。' },
    { type: 'dialog', text: '明镜一族向来有“大陆的智者”这一称号，只是近些年来，一直没有传出什么大突破。' },
    { type: 'map', data: new MapData(mingjingyu)},

    //==========================================================
    //                 第五幕 誓约域 (信) - 废弃基站
    //==========================================================
    { type: 'bgm', name: 'shihuo', fade: 800, loop: true, volume: 0.3},
    { type: 'cg', url: './assets/img/story/5-0.jpg', text: '第五幕 誓约族' },
    { type: 'dialog', text: '一诺千金，不破誓音。有我一族，名曰“誓约”。' },
    { type: 'dialog', text: '誓约族做生意很厉害，这里的集市是世界上最繁华的地方。' },
     { type: 'map', data: new MapData(shiyueyu)},
     //进入基站后

     // =======================================================================
    //                           最终幕：结局
    // =======================================================================
    { type: 'bgm', name: 'prologue_theme', fade: 1200, loop: true },
    { type: 'cg', url: './assets/img/story/0-6.jpg', text: '最终幕' },
    
    { type: 'dialog', character: './assets/img/character/B.png', text: '你回来了！跨越五域实在太难了……我们还担心你……快，坐下说。你的脸色……看起来经历了很多。' },
    { type: 'dialog', character: './assets/img/character/player.png', text: '（缓缓坐下，将那个记录了大量数据的调查装置放在桌上，手指无意识地轻抚过表面）嗯。看到了很多……也想起了很多。' },
    { type: 'dialog', character: './assets/img/character/B.png', text: '（注意到 A 的神情和动作）你的头疼……？' },
    { type: 'dialog', character: './assets/img/character/player.png', text: '（露出一丝复杂的微笑）没有再犯了。或许……是找到了比止痛更有效的东西。这些，是我们消失的过去，也是我们未来的答案。' },
    
    // This is the main branching point that determines the ending.
    // It first checks for the best ending (HE), then the worst ending (BE),
    // and defaults to the true ending (TE) for all other cases.

    {
        type: 'branch',
        // Condition for the best ending (HE)
        condition: {
            valueChecks: [
                { stat: 'history', op: '>=', value: 90 },
                { stat: 'virtue', op: '>=', value: 95 }
            ]
        },
        // Actions to run if the HE condition is met
        then: [
            { type: 'bgm', name: 'he', fade: 800, loop: true, volume: 0.8 },
            { type: 'dialog', character: './assets/img/character/B.png', text: '（快速浏览着数据，表情从震惊逐渐变为难以置信的狂喜）这……这太不可思议了！你几乎完全复原了断档的历史！还有这些……仪序城的规则、寂灭山的真相、慈谷族的善意、明镜域的星图、誓约族的忏悔……你不仅找到了历史，你还在每个地方重新点燃了它们！这比我们期望的最好结果还要好！' },
            { type: 'dialog', character: './assets/img/character/player.png', text: '第一次大陆陷入危机的时候，五域尝试把美德作为筹码放上天平，结果却是美德失衡、自相残杀、文明断档、苟延残喘至今。天平的交易成功了，但并不是以前人预期的方式。' },
            { type: 'dialog', character: './assets/img/character/player.png', text: '（目光望向窗外，仿佛能看到五域正在发生的变化）走过了五域，我终于明白了，一个种族，把希望寄托在虚无缥缈的神话里，却将自身最宝贵的东西弃之如无，这是何等的可笑？' },
            { type: 'dialog', character: './assets/img/character/player.png', text: '（深吸一口气，继续说）但当我看到了井边遵守规则取水的民众、审判长幡然醒悟后的泪水、高墙因一块饼干而崩塌的声响、族人重新仰望星空的双眼、石阵前面对真相的沉默……我知道，美德从未消失，只是被遗忘和恐惧掩埋了。我们需要的不是交易，而是唤醒。' },
            { type: 'dialog', character: './assets/img/character/B.png', text: '（郑重地点头）是的……是的！你说得对！现在我要把这份报告交给系统评估，这一次，我们要自救。' },
            { type: 'dialog', character: './assets/img/character/player.png', text: '（站起身，微微一笑）走吧。是时候让这片大陆，看清自己真正的重量了。' },
            { type: 'dialog', text: '（系统提示：正在生成最终评估报告……）' },
            // Fade to black and start the HE ending sequence
            { type: 'achievement', id: 6 }, // Unlocks "自衡之心"
            
            { type: 'cg', url: './assets/img/achv/he.jpg' },
            {
                type: 'end_credits',
                speed: 55, // Optional: pixels per second, adjust for desired scroll speed
                lines: [
                    "【结局：新生黎明】",
                    "", // An empty string creates a blank line for pacing
                    "我们曾将美德置于天平，以为可称量、可交易，",
                    "献上礼义仁智信，换取一线生机。",
                    "",
                    "我们错了——大错特错！",
                    "",
                    "那天平从未垂怜乞求者，",
                    "它冷眼旁观，只称量人心之轻重。",
                    "",
                    "而今幡然醒悟，",
                    "以美德为种子，",
                    "在战火焦土中埋下，",
                    "在谎言残垣中浇灌。",
                    "",
                    "看啊——",
                    "",
                    "天平终于无需外物而自衡，",
                    "因它衡量的不再是代价，",
                    "而是人心本真的重量。",
                    "",
                    "这片大陆，终在觉醒中重获新生。"
                ]
            },
            
            { type: 'cg', url: './assets/img/story/black_screen.png', text: '【你以为这就结束了？】' },

{ type: 'cg', url: './assets/img/story/6-1.jpg', text: '（祂静立于虚无中，身形通透，眼神沉静而深邃。）' },
{ type: 'dialog', text: '文明的重置……是一次权衡。' },
{ type: 'dialog',  text: '万物需平衡。倾覆的文明，只为等待新生。' },
{ type: 'dialog', text: '祂的目光仿佛看穿时空，眼中流露出悲悯与公正。' },

{ type: 'cg', url: './assets/img/story/6-2.jpg' },
{ type: 'dialog', character: './assets/img/character/player.png', text: '我曾是规则，是尺度，是冰冷的度量。但这一次……我想知道被衡量的重量。' },
{ type: 'dialog', character: './assets/img/character/player.png', text: '我衡量万物……直至这一次，我行走于众生之间，体会了他们的挣扎、他们的渴望、他们的善与恶……我才真正理解了被置于天平两端的，究竟是怎样的‘重量’' },
{ type: 'dialog', character: './assets/img/character/player.png', text: '文明的重量，并非源于生存的纯粹延续，亦非美德的空洞堆砌……而在于人心向背。此即，真正的‘生机’' },
{ type: 'dialog', character: './assets/img/character/player.png', text: '观测结束。基准已定。黎明…将至。' }

            
        ],
        // If the HE condition is NOT met, check for the BE condition
        else: [
            {
                type: 'branch',
                // Condition for the worst ending (BE)
                condition: {
                    valueChecks: [
                        { stat: 'history', op: '<', value: 40 },
                        { stat: 'virtue', op: '<', value: 40 }
                    ]
                },
                // Actions to run if the BE condition is met
                then: [
                    { type: 'bgm', name: 'nc', fade: 800, loop: true, volume: 0.8 },
                    { type: 'dialog', character: './assets/img/character/B.png', text: '（翻阅着数据，眉头越皱越紧，最终化为一声沉重的叹息）A……你的收获……似乎很有限。很多关键的历史片段依然缺失，而且看起来……你在各地并没有引起太多积极的改变，甚至有些地方还加剧了隔阂？' },
                    { type: 'dialog', character: './assets/img/character/player.png', text: '（显得有些回避，或许带着一丝不耐烦）历史已经尘封，何必再去深挖？能活下去才是最重要的。那些所谓的美德，在生存面前显得多么天真可笑。我拿到了他们能给的东西，这就够了。至于他们的规则、他们的麻烦……与我何干？' },
                    { type: 'dialog', character: './assets/img/character/B.png', text: '（眼神中流露出深深的失望和担忧）但这是我们了解过去、避免重蹈覆辙的唯一机会……我们需要的不仅仅是生存，而是明白为何而生存啊。如果连探寻的勇气都失去了……' },
                    { type: 'dialog', character: './assets/img/character/player.png', text: '（打断 B）够了！活下去才有未来！把这些数据交上去，应付上面的人，这才是现实！' },
                    { type: 'dialog', character: './assets/img/character/B.png', text: '（欲言- 又止，最终无奈地操作设备）……好吧。如你所愿。提交报告。' },
                    { type: 'dialog', text: '（系统提示：正在生成最终评估报告……）' },
                    { type: 'dialog', text: '（系统提示音似乎带着一丝异常的波动）' },
                    // { type: 'effect', name: 'headache' },
                    { type: 'dialog', character: './assets/img/character/player.png', text: '（突然，一阵剧烈的、前所未有的头痛袭来，比以往任何一次都要强烈）呃啊——！这……这次是……？' },
                    { type: 'dialog', text: '（A 的眼前仿佛闪过无数破碎的画面：战争的火焰、交易的天平、崩塌的文明……但它们模糊不清，无法捕捉任何意义。）' },
                    { type: 'dialog', character: './assets/img/character/B.png', text: 'A？！你怎么了？！' },
                    { type: 'dialog', character: './assets/img/character/player.png', text: '（喘着气）没……没事了。只是……有点累。结果出来了吗？' },
                    { type: 'dialog', text: '（A 不再关心那些模糊的幻象，只盯着系统屏幕，关注着即将生成的“回报”。）' },
                    // Fade to black and start the BE ending sequence
                    { type: 'achievement', id: 8 }, // Unlocks "失重的文明"
                    { type: 'cg', url: './assets/img/achv/be.jpg' },
                    { type: 'showHint', text: '【成就解锁：失重的文明】' },
                    {
                        type: 'end_credits',
                        speed: 55, // Optional: pixels per second, adjust for desired scroll speed
                        lines: [
                            "【结局：失衡的代价】",
                            "",
                            "我们高声疾呼，皆言为了生存，",
                            "竟献上了各族最为珍稀的美德瑰宝。",
                            "",
                            "我们错了——大错特错！",
                            "",
                            "命运所赐的赠礼，早在阴影中标好了价码。",
                            "",
                            "历史尘封未启，真相湮没无闻，",
                            "我们未曾探寻那断档的奥秘，",
                            "任由遗忘之雾吞噬文明的残章。",
                            "",
                            "断简残编深埋废墟之下，",
                            "我们却视而不见，只将目光紧盯天平的砝码——",
                            "",
                            "仿佛过往的教训从未存在，",
                            "只余愚昧在灰烬中重燃。",
                            "",
                            "这片大陆，却因蒙昧得以喘息，",
                            "自废墟之中，重获新生——",
                            "",
                            "只是这新生，早已浸透腐朽之息：",
                            "历史未被照亮，",
                            "我们便永陷轮回的囚笼。",
                            "",
                            "当美德成为商品，",
                            "文明终将失重——",
                            "",

                            "堕入深渊，再无归途。"
                        ]
                    },
                ],
                // If neither HE nor BE conditions are met, run the default TE
                else: [
                    { type: 'bgm', name: 'nc', fade: 800, loop: true, volume: 0.8 },
                    { type: 'dialog', character: './assets/img/character/B.png', text: '（仔细查阅数据，表情严肃而复杂）……你带回了非常重要的信息。历史碎片的拼图更完整了，那些被掩盖的战争、交易、谎言……还有你在每个地方尝试做出的努力和改变，虽然并非全部成功，但它们都意义重大。' },
                    { type: 'dialog', character: './assets/img/character/player.png', text: '（语气沉重）真相往往并不美好。我们以为献出美德换来了生存，但实际上，我们可能只是为了短暂的安宁，而出卖了让自己真正称为“文明”的东西。' },
                    { type: 'dialog', character: './assets/img/character/player.png', text: '我看到的是扭曲的规则、冰冷的审判、顽固的隔绝、被垄断的真理、和系统性的欺骗……天平的另一端，放着的或许根本不是生存，而是我们逐渐腐烂的灵魂。' },
                    { type: 'dialog', character: './assets/img/character/B.png', text: '（深吸一口气）但你没有选择视而不见。你揭开了这些伤疤，即使它们还在流血。这份报告无法立刻带来天堂，但它是一剂苦药，是敲醒麻木钟声的重锤。我们知道了错误所在，知道了代价为何。这本身就是第一步。' },
                    { type: 'dialog', character: './assets/img/character/player.png', text: '（点点头）即使前路艰难，也好过在甜美的毒药中沉沦。把真相交给所有人，让他们去判断。' },
                    { type: 'dialog', character: './assets/img/character/B.png', text: '好。提交报告吧。无论结果如何，我们都必须面对。' },
                    { type: 'dialog', text: '（系统提示：正在生成最终评估报告……）' },
                    // Fade to black and start the TE ending sequence
                    { type: 'achievement', id: 7 }, // Unlocks "苦涩真理"
                    { type: 'cg', url: './assets/img/achv/he.jpg' },
                    { type: 'showHint', text: '【成就解锁：苦涩真理】' },
                    {
                        type: 'end_credits',
                        speed: 55,
                        lines: [
                            "【结局：真相的重量】",
                            "",
                            "我们高声疾呼，皆言为了生存，",
                            "竟献上了各族最为珍稀的美德瑰宝。",
                            "",
                            "我们错了——大错特错！",
                            "",
                            "命运所赐的赠礼，早在阴影中标好了价码。",
                            "",
                            "当我们以商贾之心度量万物，",
                            "那天平便冷冷称出我等人心几两；",
                            "那被献祭的美德，犹如隔夜盛筵，",
                            "外表华美依然，却已在寂静之中腐坏、溃烂。",
                            "",
                            "而今真相如利刃剖心：",
                            "我们以信义换生存，得到的只是苟延残喘；",
                            "以仁爱换秩序，得到的只是铁腕镇压。",
                            "",
                            "天平报以的回礼，是一份变质发馊的生机。",
                            "",
                            "但我仍将真相埋入废墟之下——",
                            "愿后来者能从中拾取星火，",
                            "在漫漫长夜中，",
                            "重燃美德之火。",
                            "",
                            "这片大陆，终将在真相的灰烬中等待重生。"
                        ]
                    }
                ]
            }
        ]
    }

];

// 可选：兼容旧名
window.mainStoryElements = window.mainStoryElements || window.storyData;